<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026å¹´å“ˆçˆ¾æ¿±ä¹‹æ—… (æœ€çµ‚ä¿®æ­£ç‰ˆ)</title>
    <style>
        :root {
            --primary: #007AFF;
            --secondary: #5AC8FA;
            --bg: #F2F2F7;
            --card-bg: #FFFFFF;
            --text-main: #1C1C1E;
            --text-sub: #3C3C43;
            --text-light: #8E8E93;
            --accent: #FF9500;
            --hotel-color: #AF52DE;
            --flight-color: #FF2D55;
            --money-green: #34C759;
            --expense-red: #FF3B30;
            --tip-bg: #FFF8E1;
            --tip-text: #F57F17;
            --ai-purple: #6c5ce7;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            padding-bottom: 100px;
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
            line-height: 1.5;
        }

        /* --- Header --- */
        .header {
            background: linear-gradient(135deg, #0A2342, #007AFF);
            color: white;
            padding: 30px 20px 25px;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        .header h1 { margin: 0; font-size: 26px; font-weight: 800; letter-spacing: 0.5px; }
        .header .subtitle { font-size: 14px; opacity: 0.9; margin-top: 6px; font-weight: 500; }
        .header .trip-badges { margin-top: 15px; display: flex; gap: 8px; flex-wrap: wrap; }
        .badge { 
            background: rgba(255,255,255,0.15); 
            padding: 5px 12px; 
            border-radius: 15px; 
            font-size: 13px; 
            font-weight: 600;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Countdown */
        .countdown-container {
            margin-top: 20px;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 12px;
            text-align: center;
        }
        .countdown-text { font-size: 13px; color: rgba(255,255,255,0.9); }
        .countdown-number { font-size: 16px; font-weight: bold; color: #FFD700; }

        /* --- Views Toggle --- */
        .view-section { display: none; animation: fadeIn 0.3s ease-out; }
        .view-section.active { display: block; }

        /* --- Navigation (Top Scroller) --- */
        .nav-container {
            position: sticky;
            top: 0;
            background: rgba(242, 242, 247, 0.95);
            backdrop-filter: blur(12px);
            z-index: 100;
            padding: 12px 0;
            box-shadow: 0 1px 0 rgba(0,0,0,0.05);
        }
        .nav-scroller {
            white-space: nowrap;
            overflow-x: auto;
            padding: 0 15px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .nav-scroller::-webkit-scrollbar { display: none; }
        .nav-item {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            margin-right: 8px;
            background: var(--card-bg);
            border-radius: 16px;
            color: var(--text-light);
            font-size: 14px;
            font-weight: 600;
            transition: all 0.25s;
            border: 1px solid rgba(0,0,0,0.03);
            min-width: 60px;
        }
        .nav-item.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(0,122,255,0.35);
            transform: scale(1.05);
        }
        .nav-item span { font-size: 11px; font-weight: 400; margin-top: 2px; }

        /* --- Content Container --- */
        .container { padding: 20px 15px; max-width: 650px; margin: 0 auto; }

        /* --- Day Cards --- */
        .day-card {
            background: var(--card-bg);
            border-radius: 24px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.06);
            overflow: hidden;
            scroll-margin-top: 85px;
            border: 1px solid rgba(0,0,0,0.02);
        }
        .day-header {
            padding: 18px 20px;
            border-bottom: 1px solid #F5F5F5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to right, #ffffff, #f9f9f9);
        }
        .day-tag { 
            background: #E5F1FF; color: var(--primary); 
            padding: 6px 14px; border-radius: 10px; font-weight: 800; font-size: 15px;
        }
        .day-date { font-size: 14px; color: var(--text-light); font-weight: 500; }
        .day-content { padding: 25px 20px; }

        /* --- Timeline --- */
        .timeline { position: relative; padding-left: 12px; margin-top: 10px; }
        .timeline::before {
            content: ''; position: absolute; left: 21px; top: 10px; bottom: 30px; width: 2px; background: #E5E5EA; z-index: 0;
        }
        .activity-item { position: relative; display: flex; margin-bottom: 35px; z-index: 1; }
        .activity-time {
            position: absolute;
            left: -10px; top: -25px;
            background: var(--card-bg); padding: 2px 8px; border-radius: 10px;
            font-size: 12px; font-weight: 700; color: var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 3;
        }
        .activity-icon {
            width: 44px; height: 44px; background: white; border: 2px solid #E5E5EA; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 20px; margin-right: 18px; flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); z-index: 2;
        }
        .activity-details h3 { margin: 0 0 6px; font-size: 16px; font-weight: 700; color: var(--text-main); }
        .activity-details p { margin: 0 0 6px; font-size: 14px; color: var(--text-sub); }
        .detail-list { list-style: none; padding: 0; margin: 5px 0; }
        .detail-list li { position: relative; padding-left: 15px; font-size: 13px; color: #666; margin-bottom: 4px; }
        .detail-list li::before { content: 'â€¢'; position: absolute; left: 0; color: var(--primary); }

        /* --- Info Cards --- */
        .info-card { border-radius: 16px; padding: 16px; margin-top: 25px; font-size: 13px; position: relative; border: 1px solid transparent; }
        .hotel-box { background: #F9F0FF; border-color: rgba(175, 82, 222, 0.1); }
        .hotel-icon-bg { background: #EBD4FF; color: var(--hotel-color); }
        .flight-box { background: #FFF0F5; border-color: rgba(255, 45, 85, 0.1); margin-bottom: 25px; margin-top: 0; }
        .flight-icon-bg { background: #FFD4DE; color: var(--flight-color); }
        .box-header { display: flex; align-items: center; margin-bottom: 12px; }
        .box-icon { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 14px; }
        .box-title { font-weight: 700; font-size: 15px; }
        .box-highlight { font-weight: 600; color: #000; display: block; margin-bottom: 4px; }
        .box-meta { margin-top: 10px; padding-top: 10px; border-top: 1px dashed rgba(0,0,0,0.1); color: #777; font-size: 12px; display: flex; flex-wrap: wrap; gap: 10px; }
        .meta-tag { background: rgba(255,255,255,0.6); padding: 2px 6px; border-radius: 4px; }
        .flight-segment { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.7); padding: 12px; border-radius: 12px; margin-bottom: 8px; }
        .flight-time { font-weight: 800; color: #333; font-size: 16px; }
        .flight-route { text-align: center; flex: 1; padding: 0 10px; }
        .flight-arrow { color: var(--flight-color); font-size: 18px; display: block; }
        .flight-number { font-size: 11px; background: var(--flight-color); color: white; padding: 2px 6px; border-radius: 4px; }
        
        /* --- Tip Box --- */
        .tip-box { background: var(--tip-bg); border-radius: 8px; padding: 10px 12px; font-size: 13px; color: var(--text-sub); margin-top: 8px; border-left: 3px solid var(--tip-text); }
        .tip-title { color: var(--tip-text); font-weight: 700; display: block; margin-bottom: 4px; }

        /* --- Accounting --- */
        .accounting-card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .balance-summary { background: linear-gradient(135deg, #34C759, #30B350); color: white; border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 8px 20px rgba(52, 199, 89, 0.3); text-align: center; }
        .balance-title { font-size: 14px; opacity: 0.9; margin-bottom: 5px; }
        .balance-amount { font-size: 32px; font-weight: 800; margin-bottom: 15px; }
        .debt-list { background: rgba(255,255,255,0.2); border-radius: 12px; padding: 15px; text-align: left; font-size: 14px; }
        .debt-item { display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px dashed rgba(255,255,255,0.3); }
        .debt-item:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
        .debt-money { font-weight: bold; color: #FFD700; }

        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 13px; color: #888; margin-bottom: 5px; font-weight: 600; }
        .form-row { display: flex; gap: 10px; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #E5E5EA; border-radius: 12px; font-size: 16px; box-sizing: border-box; -webkit-appearance: none; background: #FAFAFA; }
        .form-input:focus { outline: none; border-color: var(--primary); background: white; }
        
        .btn-primary { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 14px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(0,122,255,0.3); margin-top: 10px; }
        .btn-secondary { background: #F2F2F7; color: var(--primary); border: 1px solid #E5E5EA; padding: 10px 15px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; white-space: nowrap; }
        .btn-ai { width: 100%; background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; border: none; padding: 12px; border-radius: 14px; font-size: 15px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(108, 92, 231, 0.3); margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary:active, .btn-secondary:active, .btn-ai:active { transform: scale(0.98); }

        .expense-list { margin-top: 20px; }
        .expense-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee; }
        .expense-info h4 { margin: 0; font-size: 16px; color: #333; }
        .expense-info span { font-size: 12px; color: #999; }
        .expense-amount-group { text-align: right; }
        .expense-amount { font-weight: 700; color: var(--expense-red); font-size: 16px; }
        .expense-original { font-size: 11px; color: #999; }
        .delete-btn { color: #ccc; margin-left: 15px; font-size: 20px; cursor: pointer; padding: 5px; }

        /* --- AI Chat --- */
        .chat-container { display: flex; flex-direction: column; height: calc(100vh - 220px); background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .chat-messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        .chat-input-area { padding: 15px; border-top: 1px solid #eee; background: #fff; display: flex; gap: 10px; }
        .chat-bubble { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.5; }
        .chat-bubble.user { background: var(--primary); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .chat-bubble.ai { background: #F2F2F7; color: #333; align-self: flex-start; border-bottom-left-radius: 4px; }
        .loading-dots::after { content: ' .'; animation: dots 1s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60%, 100% { content: ' ...'; } }

        /* --- Bottom Tab Bar --- */
        .tab-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; padding-bottom: max(10px, env(safe-area-inset-bottom)); box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 500; }
        .tab-item { display: flex; flex-direction: column; align-items: center; color: #999; text-decoration: none; font-size: 10px; width: 33%; }
        .tab-item.active { color: var(--primary); }
        .tab-icon { font-size: 24px; margin-bottom: 2px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="header">
        <h1>2026å¹´å“ˆçˆ¾æ¿±ä¹‹æ—…</h1>
        <div class="subtitle">å“ˆçˆ¾æ¿±Â·é•·ç™½å±±Â·å»¶å‰Â·é’å³¶ æ·±åº¦7æ—¥éŠ</div>
        <div class="trip-badges">
            <span class="badge">ğŸ“… 2026.02.08 - 02.14 (7å¤©6å¤œ)</span>
        </div>
        <div class="countdown-container">
            <div class="countdown-text">è·é›¢å‡ºç™¼é‚„æœ‰</div>
            <div class="countdown-number" id="countdown">è¨ˆç®—ä¸­...</div>
        </div>
    </div>

    <!-- Main Content Area -->
    
    <!-- SECTION 1: ITINERARY -->
    <div id="section-itinerary" class="view-section active">
        <div class="nav-container">
            <div class="nav-scroller">
                <div class="nav-item active" onclick="scrollToDay('day1', this)">Day 1<span>å‡ºç™¼</span></div>
                <div class="nav-item" onclick="scrollToDay('day2', this)">Day 2<span>å“ˆçˆ¾æ¿±</span></div>
                <div class="nav-item" onclick="scrollToDay('day3', this)">Day 3<span>é•·ç™½å±±</span></div>
                <div class="nav-item" onclick="scrollToDay('day4', this)">Day 4<span>å¤©æ± </span></div>
                <div class="nav-item" onclick="scrollToDay('day5', this)">Day 5<span>å»¶å‰</span></div>
                <div class="nav-item" onclick="scrollToDay('day6', this)">Day 6<span>é’å³¶</span></div>
                <div class="nav-item" onclick="scrollToDay('day7', this)">Day 7<span>è¿”ç¨‹</span></div>
            </div>
        </div>

        <div class="container">
            <!-- Day 1 -->
            <div id="day1" class="day-card">
                <div class="day-header"><span class="day-tag">Day 1</span><span class="day-date">2æœˆ8æ—¥ (é€±æ—¥)</span></div>
                <div class="day-content">
                    <div class="info-card flight-box">
                        <div class="box-header"><div class="box-icon flight-icon-bg">âœˆï¸</div><div class="box-title" style="color:var(--flight-color)">å»ç¨‹èˆªç­</div></div>
                        <div class="box-content">
                            <div class="flight-segment">
                                <div><div class="flight-time">07:05</div><div class="flight-code">TPE å°åŒ—</div></div>
                                <div class="flight-route"><span class="flight-number">BR170</span><span class="flight-arrow">â</span></div>
                                <div><div class="flight-time">10:30</div><div class="flight-code">ICN é¦–çˆ¾</div></div>
                            </div>
                            <div style="text-align:center;font-size:11px;color:#999;">è½‰æ©Ÿ 1h 50m</div>
                            <div class="flight-segment">
                                <div><div class="flight-time">12:20</div><div class="flight-code">ICN é¦–çˆ¾</div></div>
                                <div class="flight-route"><span class="flight-number">OZ339</span><span class="flight-arrow">â</span></div>
                                <div><div class="flight-time">13:35</div><div class="flight-code">HRB å“ˆçˆ¾æ¿±</div></div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline">
                        <div class="activity-item" style="margin-top:20px;">
                            <div class="activity-time">13:35</div>
                            <div class="activity-icon">ğŸ›¬</div>
                            <div class="activity-details"><h3>æŠµé”å“ˆçˆ¾æ¿±</h3><p>å°ˆå±¬å¸æ©Ÿæ¥æ©Ÿï¼Œå‰å¾€é…’åº—ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">15:00</div>
                            <div class="activity-icon">ğŸ¨</div>
                            <div class="activity-details"><h3>è¾¦ç†å…¥ä½</h3><p>å…¥ä½å¦‚å®¶å•†æ—…é£¯åº—ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">16:00</div>
                            <div class="activity-icon">ğŸ¡</div>
                            <div class="activity-details"><h3>è‡ªç”±æ´»å‹•æ¨è–¦</h3><p>å‰å¾€å“ˆè—¥å…­å» (é©åˆæ‹ç…§)æˆ–ä¸ƒä¸‰ä¸€éºå€ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">18:30</div>
                            <div class="activity-icon">ğŸ¥£</div>
                            <div class="activity-details"><h3>æ™šé¤ (è‡ªç†)</h3><p>æ¨è–¦å˜—è©¦æ±åŒ—éµé‹ç‡‰ã€‚</p></div>
                        </div>
                    </div>
                    <div class="info-card hotel-box">
                        <div class="box-header"><div class="box-icon hotel-icon-bg">ğŸ¨</div><div class="box-title" style="color:var(--hotel-color)">å¦‚å®¶å•†æ—…é£¯åº— (å®‰åœ‹è¡—)</div></div>
                        <div class="box-content">
                            <span class="box-highlight">å¦‚å®¶å•†æ—…é£¯åº— (å“ˆçˆ¾æ¿±ä¸­å¤®å¤§è¡—åœ°éµç«™å®‰åœ‹è¡—åº—)</span>
                            åœ°å€ï¼šå“ˆçˆ¾æ¿±é“é‡Œå€å®‰åœ‹è¡—76è™Ÿ <br>
                            <span style="font-size:12px;color:#888;">ğŸ“ é›»è©±: +86-451-84215997</span><br>
                            <span class="meta-tag" style="background: #eee; color: #666;">ç„¡æ—©é¤</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Day 2 -->
            <div id="day2" class="day-card">
                <div class="day-header"><span class="day-tag">Day 2</span><span class="day-date">2æœˆ9æ—¥ (é€±ä¸€)</span></div>
                <div class="day-content">
                    <div class="timeline">
                        <div class="activity-item">
                            <div class="activity-time">09:00</div>
                            <div class="activity-icon">ğŸ°</div>
                            <div class="activity-details"><h3>å¸‚å€ç²¾è¯å·¡ç¦®</h3><p>åƒè§€è–ç´¢è²äºæ•™å ‚å»£å ´ï¼Œæ¼«æ­¥ä¸­å¤®å¤§è¡—ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">11:00</div>
                            <div class="activity-icon">ğŸ›ï¸</div>
                            <div class="activity-details"><h3>é˜²æ´ªç´€å¿µå¡”</h3><p>éŠè¦½é˜²æ´ªç´€å¿µå¡”èˆ‡æ–¯å¤§æ—å…¬åœ’ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">12:00</div>
                            <div class="activity-icon">ğŸ¥£</div>
                            <div class="activity-details"><h3>åˆé¤</h3><p>ä¸­å¤®å¤§è¡—é™„è¿‘äº«ç”¨ä¿„å¼è¥¿é¤æˆ–æ±åŒ—èœã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">13:30</div>
                            <div class="activity-icon">â›„</div>
                            <div class="activity-details"><h3>æ¾èŠ±æ±Ÿå†°ä¸Šæ´»å‹•</h3><p>æ‰“å¡å¤–ç˜å¤§é›ªäººï¼Œè§€çœ‹å†¬æ³³ï¼Œé«”é©—å†°å˜ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">15:30</div>
                            <div class="activity-icon">â„ï¸</div>
                            <div class="activity-details"><h3>å†°é›ªå¤§ä¸–ç•Œ</h3><p>é€²å…¥åœ’å€ï¼Œæ¬£è³æ—¥è½èˆ‡å¤œæ™šç‡ˆå…‰ç§€ï¼Œé«”é©—è¶…é•·å†°æ»‘æ¢¯ã€‚</p></div>
                        </div>
                    </div>
                    <div class="info-card hotel-box">
                        <div class="box-header"><div class="box-icon hotel-icon-bg">ğŸ¨</div><div class="box-title">å¦‚å®¶å•†æ—…é£¯åº— (çºŒä½)</div></div>
                        <div class="box-content">
                            åœ°å€ï¼šå“ˆçˆ¾æ¿±é“é‡Œå€å®‰åœ‹è¡—76è™Ÿ <br>
                            <span style="font-size:12px;color:#888;">ğŸ“ é›»è©±: +86-451-84215997</span><br>
                            <span class="meta-tag" style="background: #eee; color: #666;">ç„¡æ—©é¤</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Day 3 -->
            <div id="day3" class="day-card">
                <div class="day-header"><span class="day-tag">Day 3</span><span class="day-date">2æœˆ10æ—¥ (é€±äºŒ)</span></div>
                <div class="day-content">
                    <div class="timeline">
                        <div class="activity-item">
                            <div class="activity-time">08:00</div>
                            <div class="activity-icon">ğŸšŒ</div>
                            <div class="activity-details"><h3>å‡ºç™¼å‰å¾€é¡æ³Šæ¹–</h3><p>ä¹˜è»Šå‰å¾€é¡æ³Šæ¹–æ™¯å€ (æˆ–æ©«é“æ²³å­)ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">11:00</div>
                            <div class="activity-icon">ğŸŸ</div>
                            <div class="activity-details"><h3>é¡æ³Šæ¹–å†¬æ•</h3><p>è§€çœ‹å‚³çµ±æ¼çµå†¬æ•å„€å¼ï¼Œæ¬£è³åŠæ°´æ¨“å†°ç€‘ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">13:00</div>
                            <div class="activity-icon">ğŸ¥£</div>
                            <div class="activity-details"><h3>åˆé¤</h3><p>äº«ç”¨ç•¶åœ°ç‰¹è‰²é­šå®´ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">15:00</div>
                            <div class="activity-icon">ğŸš„</div>
                            <div class="activity-details"><h3>å‰å¾€é•·ç™½å±±</h3><p>æ­ä¹˜é«˜éµå‰å¾€äºŒé“ç™½æ²³ (é•·ç™½å±±è…³ä¸‹)ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">18:00</div>
                            <div class="activity-icon">â™¨ï¸</div>
                            <div class="activity-details"><h3>å…¥ä½ & æº«æ³‰</h3><p>å…¥ä½æº«æ³‰é…’åº—ï¼Œäº«å—ç«å±±æº«æ³‰ (è«‹è‡ªå‚™æ³³è¡£)ã€‚</p></div>
                        </div>
                    </div>
                    <div class="info-card hotel-box">
                        <div class="box-header"><div class="box-icon hotel-icon-bg">ğŸ¨</div><div class="box-title" style="color:var(--hotel-color)">æ—¥å‰ç´æº«æ³‰é£¯åº—</div></div>
                        <div class="box-content">
                            <span class="box-highlight">é•·ç™½å±±åŒ—å¡é›†æ•£ä¸­å¿ƒæ—¥å‰ç´æº«æ³‰é£¯åº—</span>
                            åœ°å€ï¼šå®‰åœ–é•·ç™½å±±å¤§è¡—38è™Ÿ <br>
                            <span style="font-size:12px;color:#888;">ğŸ“ é›»è©±: +86-433-5936888</span><br>
                            <span class="meta-tag" style="background: #e6ffe6; color: #008000;">å«æ—©é¤</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Day 4 -->
            <div id="day4" class="day-card">
                <div class="day-header"><span class="day-tag">Day 4</span><span class="day-date">2æœˆ11æ—¥ (é€±ä¸‰)</span></div>
                <div class="day-content">
                    <div class="timeline">
                        <div class="activity-item">
                            <div class="activity-time">08:30</div>
                            <div class="activity-icon">ğŸ”ï¸</div>
                            <div class="activity-details"><h3>é•·ç™½å±±åŒ—å¡</h3><p>é€²å…¥æ™¯å€ï¼Œæ›ä¹˜ç’°ä¿è»Šèˆ‡å€’ç«™è»Šã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">09:30</div>
                            <div class="activity-icon">â˜ï¸</div>
                            <div class="activity-details"><h3>å¤©æ± </h3><p>ç™»é ‚ä¿¯ç°ç¥ç§˜çš„å¤©æ±  (è¦–å¤©æ°£é–‹æ”¾)ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">11:30</div>
                            <div class="activity-icon">ğŸŒŠ</div>
                            <div class="activity-details"><h3>ç€‘å¸ƒèˆ‡ç¶ æ·µæ½­</h3><p>éŠè¦½é•·ç™½ç€‘å¸ƒã€ç¶ æ·µæ½­åŠåœ°ä¸‹æ£®æ—ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">14:00</div>
                            <div class="activity-icon">ğŸš£</div>
                            <div class="activity-details"><h3>éœ§å‡‡æ¼‚æµ</h3><p>é«”é©—é­”ç•Œéœ§å‡‡æ¼‚æµåŠé›ªäººè»åœ˜æ‰“å¡ã€‚</p></div>
                        </div>
                    </div>
                    <div class="info-card hotel-box">
                        <div class="box-header"><div class="box-icon hotel-icon-bg">ğŸ¨</div><div class="box-title">æ—¥å‰ç´æº«æ³‰é£¯åº— (çºŒä½)</div></div>
                        <div class="box-content">
                            åœ°å€ï¼šå®‰åœ–é•·ç™½å±±å¤§è¡—38è™Ÿ <br>
                            <span style="font-size:12px;color:#888;">ğŸ“ é›»è©±: +86-433-5936888</span><br>
                            <span class="meta-tag" style="background: #e6ffe6; color: #008000;">å«æ—©é¤</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Day 5 -->
            <div id="day5" class="day-card">
                <div class="day-header"><span class="day-tag">Day 5</span><span class="day-date">2æœˆ12æ—¥ (é€±å››)</span></div>
                <div class="day-content">
                    <div class="timeline">
                        <div class="activity-item">
                            <div class="activity-time">08:30</div>
                            <div class="activity-icon">ğŸšŒ</div>
                            <div class="activity-details"><h3>å‡ºç™¼å‰å¾€é›ªå¶º</h3><p>å‰å¾€è€é‡Œå…‹æ¹–æˆ–ä»™å³°é›ªå¶ºã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">10:00</div>
                            <div class="activity-icon">ğŸ¦Œ</div>
                            <div class="activity-details"><h3>é›ªå¶ºç«¥è©±</h3><p>é«”é©—é¦¬æ‹‰çˆ¬çŠ/é›ªåœ°æ‘©æ‰˜ï¼Œèˆ‡é¦´é¹¿äº’å‹•ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">13:00</div>
                            <div class="activity-icon">ğŸšŒ</div>
                            <div class="activity-details"><h3>å‰å¾€å»¶å‰</h3><p>ä¹˜è»Šå‰å¾€å»¶å‰å¸‚ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">15:30</div>
                            <div class="activity-icon">ğŸ“¸</div>
                            <div class="activity-details"><h3>æœé®®æ°‘ä¿—åœ’</h3><p>æ›ä¸ŠéŸ“æœé€²è¡Œæ—…æ‹ï¼Œé«”é©—æœé®®æ—é¢¨æƒ…ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">18:30</div>
                            <div class="activity-icon">ğŸŒƒ</div>
                            <div class="activity-details"><h3>ç¶²ç´…ç‰† & æ™šé¤</h3><p>å»¶å¤§ç¶²ç´…ç‰†æ‰“å¡ï¼Œäº«ç”¨æ­£å®—éŸ“å¼çƒ¤è‚‰ã€‚</p></div>
                        </div>
                    </div>
                    <div class="info-card hotel-box">
                        <div class="box-header"><div class="box-icon hotel-icon-bg">ğŸ¨</div><div class="box-title" style="color:var(--hotel-color)">å»¶å‰å¸Œçˆ¾é “é€¸æ—é…’åº—</div></div>
                        <div class="box-content">
                            <span class="box-highlight">DoubleTree by Hilton Hotel Yanji</span>
                            åœ°å€ï¼šå»¶å‰å…¬åœ’è·¯2551è™Ÿ <br>
                            <span style="font-size:12px;color:#888;">ğŸ“ é›»è©±: +86-433-2787777</span><br>
                            <span class="meta-tag" style="background: #e6ffe6; color: #008000;">å«æ—©é¤</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Day 6 -->
            <div id="day6" class="day-card">
                <div class="day-header"><span class="day-tag">Day 6</span><span class="day-date">2æœˆ13æ—¥ (é€±äº”)</span></div>
                <div class="day-content">
                    <div class="timeline">
                        <div class="activity-item">
                            <div class="activity-time">06:30</div>
                            <div class="activity-icon">ğŸ›ï¸</div>
                            <div class="activity-details"><h3>æ°´ä¸Šå¸‚å ´ (æ—©å¸‚)</h3><p>é«”é©—å»¶å‰ç…™ç«æ°£ï¼Œå“å˜—æ‰“ç³•ã€ç±³è…¸ç­‰ç¾é£Ÿã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">09:30</div>
                            <div class="activity-icon">ğŸ›ï¸</div>
                            <div class="activity-details"><h3>å»¶é‚Šåšç‰©é¤¨</h3><p>äº†è§£å»¶é‚Šæ­·å²èˆ‡æ–‡åŒ–ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">12:30</div>
                            <div class="activity-icon">ğŸš„</div>
                            <div class="activity-details"><h3>å‰å¾€æ©Ÿå ´</h3><p>å¾å»¶å‰è¥¿ç«™æ­ä¹˜é«˜éµå‰å¾€é•·æ˜¥é¾å˜‰æ©Ÿå ´ã€‚</p></div>
                        </div>
                    </div>
                    <div class="info-card flight-box">
                        <div class="box-header"><div class="box-icon flight-icon-bg">âœˆï¸</div><div class="box-title" style="color:var(--flight-color)">åœ‹å…§èˆªç­ï¼šé£›å¾€é’å³¶</div></div>
                        <div class="box-content">
                            <div class="flight-segment">
                                <div><div class="flight-time">19:05</div><div class="flight-code">CGQ é•·æ˜¥</div></div>
                                <div class="flight-route"><span class="flight-number">HO2016</span><span class="flight-arrow">â</span></div>
                                <div><div class="flight-time">21:15</div><div class="flight-code">TAO é’å³¶</div></div>
                            </div>
                        </div>
                    </div>
                    <div class="info-card hotel-box">
                        <div class="box-header"><div class="box-icon hotel-icon-bg">ğŸ¨</div><div class="box-title" style="color:var(--hotel-color)">é’å³¶è† å·è¬è±ªé£¯åº—</div></div>
                        <div class="box-content">
                            <span class="box-highlight">Qingdao Jiaozhou Marriott Hotel</span>
                            åœ°å€ï¼šè† å·å°‘æµ·ä¸­è·¯88è™Ÿ <br>
                            <span style="font-size:12px;color:#888;">ğŸ“ é›»è©±: +86-532-88696888</span><br>
                            <span class="meta-tag" style="background: #e6ffe6; color: #008000;">å«æ—©é¤</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Day 7 -->
            <div id="day7" class="day-card">
                <div class="day-header"><span class="day-tag" style="background:#FFE5E5;color:#FF2D55;">Day 7</span><span class="day-date">2æœˆ14æ—¥ (é€±å…­)</span></div>
                <div class="day-content">
                    <div class="timeline">
                        <div class="activity-item">
                            <div class="activity-time">09:00</div>
                            <div class="activity-icon">ğŸ¥</div>
                            <div class="activity-details"><h3>é£¯åº—æ—©é¤</h3><p>åœ¨è¬è±ªé£¯åº—äº«ç”¨æ—©é¤ã€‚</p></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">11:30</div>
                            <div class="activity-icon">ğŸ‘‹</div>
                            <div class="activity-details"><h3>é€€æˆ¿ & å‰å¾€æ©Ÿå ´</h3><p>è¾¦ç†é€€æˆ¿æ‰‹çºŒï¼Œå‰å¾€é’å³¶è† æ±æ©Ÿå ´ã€‚</p></div>
                        </div>
                    </div>
                    <div class="info-card flight-box">
                        <div class="box-header"><div class="box-icon flight-icon-bg">âœˆï¸</div><div class="box-title" style="color:var(--flight-color)">è¿”ç¨‹èˆªç­</div></div>
                        <div class="box-content">
                            <div class="flight-segment">
                                <div><div class="flight-time">14:30</div><div class="flight-code">TAO é’å³¶</div></div>
                                <div class="flight-route"><span class="flight-number">CX 0951</span><span class="flight-arrow">â</span></div>
                                <div><div class="flight-time">18:15</div><div class="flight-code">HKG é¦™æ¸¯</div></div>
                            </div>
                            <div style="text-align:center;font-size:11px;color:#999;">è½‰æ©Ÿ 1h 25m</div>
                            <div class="flight-segment">
                                <div><div class="flight-time">19:40</div><div class="flight-code">HKG é¦™æ¸¯</div></div>
                                <div class="flight-route"><span class="flight-number">CX 0464</span><span class="flight-arrow">â</span></div>
                                <div><div class="flight-time">21:20</div><div class="flight-code">TPE å°åŒ—</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="height: 50px;"></div>
        </div>
    </div>

    <!-- SECTION 2: ACCOUNTING -->
    <div id="section-accounting" class="view-section">
        <div class="container">
            <h2 style="margin-top:0;">ğŸ’° æ—…é€”è¨˜å¸³æœ¬</h2>
            
            <!-- Summary Card -->
            <div class="balance-summary">
                <div class="balance-title">ç›®å‰ç¸½æ”¯å‡º (TWD)</div>
                <div class="balance-amount" id="total-spending">NT$ 0</div>
                <div class="debt-list" id="debt-summary">
                    æš«ç„¡åˆ†å¸³è³‡è¨Š
                </div>
            </div>

            <!-- AI Expense Analysis Button -->
            <button class="btn-ai" onclick="analyzeExpenses()">
                <span>âœ¨</span> åˆ†ææˆ‘çš„æ¶ˆè²»ç‹€æ³
            </button>

            <!-- Add Expense Form -->
            <div class="accounting-card" style="margin-top: 20px;">
                <h3 style="margin-top:0;">æ–°å¢æ¶ˆè²»</h3>
                <div class="form-group">
                    <label class="form-label">æ¶ˆè²»é …ç›®</label>
                    <input type="text" id="expense-desc" class="form-input" placeholder="ä¾‹å¦‚ï¼šæ™šé¤ã€è¨ˆç¨‹è»Šè²»">
                </div>
                
                <div class="form-group">
                    <label class="form-label">é‡‘é¡</label>
                    <div class="form-row">
                        <select id="expense-currency" class="form-input" style="width: 35%;" onchange="updateRateVisibility()">
                            <option value="TWD" selected>TWD (å°å¹£)</option>
                            <option value="CNY">CNY (äººæ°‘å¹£)</option>
                        </select>
                        <input type="number" id="expense-amount" class="form-input" style="width: 65%;" placeholder="0">
                    </div>
                </div>

                <div class="form-group" id="rate-group">
                    <label class="form-label">åŒ¯ç‡ (CNY -> TWD)</label>
                    <div style="display:flex; gap:10px;">
                        <input type="number" id="expense-rate" class="form-input" value="4.449" placeholder="4.449">
                        <button class="btn-secondary" onclick="window.open('https://rate.bot.com.tw/xrt?Lang=zh-TW', '_blank')">æŸ¥è©¢å°éŠ€åŒ¯ç‡</button>
                    </div>
                    <div style="font-size:11px; color:#999; margin-top:4px;">* é»æ“ŠæŒ‰éˆ•æŸ¥çœ‹å°éŠ€å³æœŸè³£å‡ºåƒ¹ï¼Œä¸¦æ‰‹å‹•è¼¸å…¥</div>
                </div>

                <div class="form-group">
                    <label class="form-label">èª°ä»˜çš„éŒ¢ï¼Ÿ</label>
                    <select id="expense-payer" class="form-input">
                        <option value="é™³å† å»·">é™³å† å»·</option>
                        <option value="é¾ç«‹è»’">é¾ç«‹è»’</option>
                    </select>
                </div>
                <button class="btn-primary" onclick="addExpense()">+ è¨˜ä¸€ç­†</button>
            </div>

            <!-- Expense List -->
            <h3 style="margin-bottom: 10px;">æ¶ˆè²»æ˜ç´°</h3>
            <div id="expense-list-container" class="expense-list">
                <!-- Items will be added here -->
                <div style="text-align:center; color:#ccc; padding:20px;">å°šç„¡ç´€éŒ„</div>
            </div>

            <div style="margin-top:30px; text-align:center;">
                <button onclick="clearAllExpenses()" style="background:none; border:none; color:#FF3B30; text-decoration:underline;">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>
            </div>
        </div>
    </div>

    <!-- SECTION 3: AI ASSISTANT -->
    <div id="section-ai" class="view-section">
        <div class="container">
            <h2 style="margin-top:0;">âœ¨ AI éš¨èº«å°éŠ</h2>
            <div class="chat-container">
                <div id="chat-messages" class="chat-messages">
                    <div class="chat-bubble ai">
                        ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„æ±åŒ—ä¹‹æ—… AI å°éŠã€‚æˆ‘å¯ä»¥å›ç­”ä½ é—œæ–¼è¡Œç¨‹ã€å¤©æ°£ã€æ™¯é»æˆ–ç¾é£Ÿçš„å•é¡Œã€‚æƒ³çŸ¥é“ä»€éº¼å‘¢ï¼Ÿ
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="user-input" class="form-input" placeholder="å•æˆ‘é—œæ–¼è¡Œç¨‹çš„å•é¡Œ..." onkeypress="handleEnter(event)">
                    <button class="btn-primary" style="width: auto; margin: 0; padding: 0 20px;" onclick="sendMessage()">ç™¼é€</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Tab Bar -->
    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('itinerary', this)">
            <div class="tab-icon">ğŸ—ºï¸</div>
            <div>è¡Œç¨‹è¡¨</div>
        </div>
        <div class="tab-item" onclick="switchTab('accounting', this)">
            <div class="tab-icon">ğŸ’¸</div>
            <div>è¨˜å¸³æœ¬</div>
        </div>
        <div class="tab-item" onclick="switchTab('ai', this)">
            <div class="tab-icon">âœ¨</div>
            <div>AI åŠ©æ‰‹</div>
        </div>
    </div>

    <script>
        const apiKey = ""; // Gemini API Key

        // --- Itinerary Data for Context ---
        const itineraryContext = `
        è¡Œç¨‹åç¨±: 2026å¹´å“ˆçˆ¾æ¿±ä¹‹æ—…
        æ—¥æœŸ: 2026.02.08 - 02.14 (7å¤©6å¤œ)
        Day 1 (2/8): å°åŒ— -> é¦–çˆ¾ -> å“ˆçˆ¾æ¿±ã€‚å…¥ä½å¦‚å®¶å•†æ—…é£¯åº—(å®‰åœ‹è¡—)ã€‚è‡ªç”±æ´»å‹•: å“ˆè—¥å…­å» ã€ä¸ƒä¸‰ä¸€éºå€ã€‚
        Day 2 (2/9): å¸‚å€å·¡ç¦®(ä¸­å¤®å¤§è¡—ã€è–ç´¢è²äº)ã€æ¾èŠ±æ±Ÿå†°ä¸Šæ´»å‹•ã€å†°é›ªå¤§ä¸–ç•Œã€‚ä½å¦‚å®¶å•†æ—…ã€‚
        Day 3 (2/10): é¡æ³Šæ¹–å†¬æ•ã€åŠæ°´æ¨“å†°ç€‘ã€‚ä¸‹åˆé«˜éµå¾€é•·ç™½å±±äºŒé“ç™½æ²³ã€‚å…¥ä½æ—¥å‰ç´æº«æ³‰é£¯åº—(å«æº«æ³‰)ã€‚
        Day 4 (2/11): é•·ç™½å±±åŒ—å¡æ™¯å€(å¤©æ± ã€ç€‘å¸ƒã€ç¶ æ·µæ½­)ã€éœ§å‡‡æ¼‚æµã€‚ä½æ—¥å‰ç´æº«æ³‰é£¯åº—ã€‚
        Day 5 (2/12): é›ªå¶º(é¦´é¹¿ã€é›ªåœ°æ‘©æ‰˜)ã€‚ä¸‹åˆå‰å¾€å»¶å‰ã€‚é«”é©—æœé®®æ°‘ä¿—åœ’æ—…æ‹ã€ç¶²ç´…ç‰†ã€‚ä½å»¶å‰å¸Œçˆ¾é “é€¸æ—ã€‚
        Day 6 (2/13): ä¸Šåˆæ°´ä¸Šå¸‚å ´ã€å»¶é‚Šåšç‰©é¤¨ã€‚ä¸‹åˆé«˜éµå¾€é•·æ˜¥é¾å˜‰æ©Ÿå ´ï¼Œé£›å¾€é’å³¶ã€‚ä½é’å³¶è† å·è¬è±ªã€‚
        Day 7 (2/14): é’å³¶è¬è±ªæ—©é¤ï¼Œé€€æˆ¿å‰å¾€æ©Ÿå ´ã€‚é’å³¶ -> é¦™æ¸¯ -> å°åŒ—ã€‚
        æ³¨æ„: å‰å…©å¤©å“ˆçˆ¾æ¿±ä½å®¿ä¸å«æ—©é¤ï¼Œå…¶é¤˜å«æ—©é¤ã€‚
        `;

        // --- Countdown Logic ---
        function updateCountdown() {
            const tripDate = new Date("2026-02-08T07:05:00").getTime();
            const now = new Date().getTime();
            const distance = tripDate - now;

            if (distance < 0) {
                document.getElementById("countdown").innerHTML = "æ—…ç¨‹é€²è¡Œä¸­ â„ï¸";
                return;
            }
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            document.getElementById("countdown").innerHTML = `${days} å¤© ${hours} å°æ™‚`;
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();

        // --- Navigation Logic ---
        function scrollToDay(id, element) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            const el = document.getElementById(id);
            if(el) {
                const offset = 90; 
                const bodyRect = document.body.getBoundingClientRect().top;
                const elementRect = el.getBoundingClientRect().top;
                const elementPosition = elementRect - bodyRect;
                const offsetPosition = elementPosition - offset;
                window.scrollTo({ top: offsetPosition, behavior: "smooth" });
            }
        }

        // --- Tab Switching Logic ---
        function switchTab(tabId, element) {
            document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('section-' + tabId).classList.add('active');
            window.scrollTo(0, 0);
        }

        // --- Accounting Logic ---
        let expenses = JSON.parse(localStorage.getItem('trip_expenses_v2')) || [];

        function updateRateVisibility() {
            const currency = document.getElementById('expense-currency').value;
            const rateGroup = document.getElementById('rate-group');
            if (currency === 'TWD') {
                rateGroup.style.display = 'none';
            } else {
                rateGroup.style.display = 'block';
            }
        }

        function renderExpenses() {
            const container = document.getElementById('expense-list-container');
            const totalEl = document.getElementById('total-spending');
            const debtEl = document.getElementById('debt-summary');
            
            container.innerHTML = '';
            
            if (expenses.length === 0) {
                container.innerHTML = '<div style="text-align:center; color:#ccc; padding:20px;">å°šç„¡ç´€éŒ„</div>';
                totalEl.innerText = 'NT$ 0';
                debtEl.innerText = 'æš«ç„¡åˆ†å¸³è³‡è¨Š';
                return;
            }

            let totalTWD = 0;
            let paidBy = { 'é™³å† å»·': 0, 'é¾ç«‹è»’': 0 };

            // Render List & Calculate Totals
            expenses.slice().reverse().forEach((ex, index) => {
                // Calculate TWD amount for total
                let amountInTWD = ex.currency === 'CNY' ? (ex.amount * ex.rate) : ex.amount;
                totalTWD += amountInTWD;
                
                if (paidBy[ex.payer] !== undefined) {
                    paidBy[ex.payer] += amountInTWD;
                }

                const div = document.createElement('div');
                div.className = 'expense-item';
                
                let amountDisplay = '';
                let originalDisplay = '';
                
                if (ex.currency === 'CNY') {
                    amountDisplay = `NT$ ${Math.round(amountInTWD).toLocaleString()}`;
                    originalDisplay = `(Â¥${ex.amount} x ${ex.rate})`;
                } else {
                    amountDisplay = `NT$ ${ex.amount.toLocaleString()}`;
                }

                div.innerHTML = `
                    <div class="expense-info">
                        <h4>${ex.desc}</h4>
                        <span>${ex.date} Â· ${ex.payer} ä»˜æ¬¾</span>
                    </div>
                    <div style="display:flex; align-items:center;">
                        <div class="expense-amount-group">
                            <div class="expense-amount">${amountDisplay}</div>
                            <div class="expense-original">${originalDisplay}</div>
                        </div>
                        <div class="delete-btn" onclick="deleteExpense(${expenses.length - 1 - index})">Ã—</div>
                    </div>
                `;
                container.appendChild(div);
            });

            totalEl.innerText = `NT$ ${Math.round(totalTWD).toLocaleString()}`;

            // Split Logic
            const sharePerPerson = totalTWD / 2;
            const chenPaid = paidBy['é™³å† å»·'];
            // const chungPaid = paidBy['é¾ç«‹è»’'];
            
            const chenDiff = chenPaid - sharePerPerson;
            
            if (Math.abs(chenDiff) < 1) {
                debtEl.innerHTML = '<div class="debt-item" style="justify-content:center;">ç›®å‰çµæ¸… (å…©æ¸…) âœ…</div>';
            } else if (chenDiff > 0) {
                debtEl.innerHTML = `
                    <div class="debt-item">
                        <span class="debt-payer">é¾ç«‹è»’</span>
                        <span class="debt-receiver"> æ‡‰çµ¦ é™³å† å»·</span>
                        <span class="debt-money">NT$ ${Math.floor(chenDiff).toLocaleString()}</span>
                    </div>
                `;
            } else {
                 debtEl.innerHTML = `
                    <div class="debt-item">
                        <span class="debt-payer">é™³å† å»·</span>
                        <span class="debt-receiver"> æ‡‰çµ¦ é¾ç«‹è»’</span>
                        <span class="debt-money">NT$ ${Math.floor(Math.abs(chenDiff)).toLocaleString()}</span>
                    </div>
                `;
            }
        }

        function addExpense() {
            const desc = document.getElementById('expense-desc').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const payer = document.getElementById('expense-payer').value;
            const currency = document.getElementById('expense-currency').value;
            let rate = 1;

            if (currency === 'CNY') {
                rate = parseFloat(document.getElementById('expense-rate').value);
            }

            if (!desc || isNaN(amount) || amount <= 0) {
                alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„é …ç›®å’Œé‡‘é¡");
                return;
            }

            const newExpense = {
                desc: desc,
                amount: amount,
                currency: currency,
                rate: rate,
                payer: payer,
                date: new Date().toLocaleDateString()
            };

            expenses.push(newExpense);
            localStorage.setItem('trip_expenses_v2', JSON.stringify(expenses));
            
            // Clear inputs
            document.getElementById('expense-desc').value = '';
            document.getElementById('expense-amount').value = '';

            renderExpenses();
        }

        function deleteExpense(index) {
            if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†ç´€éŒ„ï¼Ÿ")) {
                expenses.splice(index, 1);
                localStorage.setItem('trip_expenses_v2', JSON.stringify(expenses));
                renderExpenses();
            }
        }

        function clearAllExpenses() {
            if(confirm("è­¦å‘Šï¼šé€™å°‡åˆªé™¤æ‰€æœ‰è¨˜å¸³è³‡æ–™ä¸”ç„¡æ³•å¾©åŸï¼ç¢ºå®šå—ï¼Ÿ")) {
                expenses = [];
                localStorage.removeItem('trip_expenses_v2');
                renderExpenses();
            }
        }

        // --- Gemini API Functions ---
        async function callGemini(prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const requestBody = {
                contents: [{
                    parts: [{ text: prompt }]
                }]
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini Error:", error);
                return "æŠ±æ­‰ï¼ŒAI æœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
            }
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            // UI Update: Add User Message
            const chatContainer = document.getElementById('chat-messages');
            chatContainer.innerHTML += `<div class="chat-bubble user">${message}</div>`;
            input.value = '';
            
            // Loading indicator
            const loadingId = 'loading-' + Date.now();
            chatContainer.innerHTML += `<div id="${loadingId}" class="chat-bubble ai loading-dots">æ€è€ƒä¸­</div>`;
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // Construct Prompt
            const fullPrompt = `
                ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„æ±åŒ—æ—…éŠå°éŠã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨è€…çš„è¡Œç¨‹è¡¨ï¼š
                ${itineraryContext}
                
                è«‹æ ¹æ“šä»¥ä¸Šè¡Œç¨‹å›ç­”ä½¿ç”¨è€…çš„å•é¡Œã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œèªæ°£è¦ªåˆ‡ç†±æƒ…ã€‚
                ä½¿ç”¨è€…å•é¡Œ: ${message}
            `;

            const reply = await callGemini(fullPrompt);
            
            // Remove loading and add reply
            document.getElementById(loadingId).remove();
            chatContainer.innerHTML += `<div class="chat-bubble ai">${reply.replace(/\n/g, '<br>')}</div>`;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        async function analyzeExpenses() {
            if (expenses.length === 0) {
                alert("è«‹å…ˆæ–°å¢å¹¾ç­†æ¶ˆè²»ç´€éŒ„å†ä¾†åˆ†æå–”ï¼");
                return;
            }

            const btn = document.querySelector('.btn-ai');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'âœ¨ åˆ†æä¸­...';
            btn.disabled = true;

            let expenseText = expenses.map(e => `${e.desc}: ${e.currency} ${e.amount}`).join('\n');
            
            const prompt = `
                ä½ æ˜¯ä¸€ä½ç†è²¡å°ˆå®¶ã€‚è«‹åˆ†æä»¥ä¸‹æ—…éŠæ¶ˆè²»æ¸…å–®ï¼Œä¸¦ç”¨ç¹é«”ä¸­æ–‡çµ¦å‡ºç°¡çŸ­çš„è©•åƒ¹èˆ‡å»ºè­°(100å­—ä»¥å…§)ã€‚
                æ¶ˆè²»æ¸…å–®:
                ${expenseText}
            `;

            const analysis = await callGemini(prompt);
            
            alert("ğŸ“Š AI åˆ†æçµæœï¼š\n\n" + analysis);
            
            btn.innerHTML = originalText;
            btn.disabled = false;
        }

        // Initial Render
        renderExpenses();
        updateRateVisibility();

    </script>
</body>
</html>
